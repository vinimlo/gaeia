---
import { RARITY_COLORS, RARITY_NAMES } from '../utils/uiConstants';

interface Props {
  id: string;
  name: string;
  description: string;
  icon: string;
  earned: boolean;
  earnedDate?: string;
  rarity?: 'common' | 'rare' | 'epic' | 'legendary';
  size?: 'sm' | 'md' | 'lg';
}

const {
  id,
  name,
  description,
  icon,
  earned,
  earnedDate,
  rarity = 'common',
  size = 'md'
} = Astro.props;

const sizes = {
  sm: {
    container: 'w-16 h-16',
    icon: 'w-8 h-8',
    tooltip: 'text-xs'
  },
  md: {
    container: 'w-20 h-20',
    icon: 'w-10 h-10',
    tooltip: 'text-sm'
  },
  lg: {
    container: 'w-24 h-24',
    icon: 'w-12 h-12',
    tooltip: 'text-base'
  }
};

const config = RARITY_COLORS[rarity];
const sizeConfig = sizes[size];
---

<div class="group relative inline-block">
  <!-- Badge Container -->
  <div
    class:list={[
      'relative rounded-xl border-2 flex items-center justify-center transition-all duration-300',
      sizeConfig.container,
      earned ? config.border : 'border-dormant/30',
      earned ? config.bg : 'bg-nebula/50',
      earned && config.glow,
      earned ? 'cursor-pointer' : 'cursor-not-allowed',
      earned && 'hover:scale-110 hover:rotate-3'
    ]}
  >
    <!-- Holographic Shimmer (earned only) -->
    {earned && (
      <div class="absolute inset-0 rounded-xl overflow-hidden pointer-events-none">
        <div class="holographic-shimmer"></div>
      </div>
    )}

    <!-- Icon -->
    <div class:list={[
      'relative z-10 flex items-center justify-center',
      sizeConfig.icon,
      earned ? config.text : 'text-dormant'
    ]}>
      {earned ? (
        <span class="text-2xl" set:html={icon} />
      ) : (
        <svg class="w-full h-full opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
      )}
    </div>

    <!-- Glow pulse for earned badges -->
    {earned && (
      <div class:list={[
        'absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300',
        rarity === 'legendary' ? 'animate-pulse-glow' : ''
      ]} style={`box-shadow: 0 0 30px ${rarity === 'legendary' ? 'rgba(255, 176, 32, 0.5)' : rarity === 'epic' ? 'rgba(167, 139, 250, 0.5)' : rarity === 'rare' ? 'rgba(0, 212, 255, 0.5)' : 'rgba(148, 163, 184, 0.3)'};`}></div>
    )}
  </div>

  <!-- Tooltip -->
  <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 opacity-0 group-hover:opacity-100 pointer-events-none transition-all duration-200 transform group-hover:-translate-y-1 z-20">
    <div class:list={[
      'glass-card px-3 py-2 rounded-lg min-w-[150px] max-w-[200px]',
      sizeConfig.tooltip
    ]}>
      <p class:list={['font-display font-semibold', earned ? config.text : 'text-faint']}>
        {name}
      </p>
      <p class="text-faint text-xs mt-1">{description}</p>
      {earned && earnedDate && (
        <p class="text-complete-pulse text-xs mt-2 flex items-center gap-1">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Conquistado em {earnedDate}
        </p>
      )}
      {!earned && (
        <p class="text-dormant text-xs mt-2 flex items-center gap-1">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
          Bloqueado
        </p>
      )}
      <!-- Rarity indicator -->
      <div class:list={[
        'mt-2 text-xs font-medium capitalize',
        config.text
      ]}>
        {RARITY_NAMES[rarity]}
      </div>
    </div>
    <!-- Tooltip arrow -->
    <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-star-dust"></div>
  </div>
</div>

<style>
  .holographic-shimmer {
    position: absolute;
    inset: -50%;
    background: linear-gradient(
      135deg,
      transparent 20%,
      rgba(255, 255, 255, 0.1) 40%,
      rgba(255, 255, 255, 0.2) 50%,
      rgba(255, 255, 255, 0.1) 60%,
      transparent 80%
    );
    animation: shimmer-move 3s ease-in-out infinite;
  }

  @keyframes shimmer-move {
    0% {
      transform: translateX(-100%) rotate(45deg);
    }
    100% {
      transform: translateX(100%) rotate(45deg);
    }
  }

  /* Pause animation when not hovering for performance */
  .group:not(:hover) .holographic-shimmer {
    animation-play-state: paused;
  }
</style>
