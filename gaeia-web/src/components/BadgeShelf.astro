---
import BadgeDisplay from './BadgeDisplay.astro';

interface Badge {
  id: string;
  name: string;
  description: string;
  icon: string;
  earned: boolean;
  earnedDate?: string;
  rarity?: 'common' | 'rare' | 'epic' | 'legendary';
}

interface Props {
  badges: Badge[];
  title?: string;
  showLocked?: boolean;
  maxDisplay?: number;
}

const {
  badges,
  title = 'Conquistas',
  showLocked = true,
  maxDisplay = 0
} = Astro.props;

const earnedBadges = badges.filter(b => b.earned);
const lockedBadges = badges.filter(b => !b.earned);

const displayBadges = showLocked
  ? badges
  : earnedBadges;

const finalBadges = maxDisplay > 0
  ? displayBadges.slice(0, maxDisplay)
  : displayBadges;

const hasMore = maxDisplay > 0 && displayBadges.length > maxDisplay;
---

<section class="space-y-4">
  {title && (
    <div class="flex items-center justify-between">
      <h3 class="font-display font-semibold text-lg text-bright flex items-center gap-2">
        <svg class="w-5 h-5 text-axon-amber" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
        </svg>
        {title}
      </h3>
      <span class="text-sm text-dim">
        {earnedBadges.length}/{badges.length} conquistadas
      </span>
    </div>
  )}

  <!-- Badge Grid -->
  <div class="flex flex-wrap gap-4">
    {finalBadges.map((badge, index) => (
      <div
        class="animate-fade-in"
        style={`animation-delay: ${index * 0.05}s;`}
      >
        <BadgeDisplay
          id={badge.id}
          name={badge.name}
          description={badge.description}
          icon={badge.icon}
          earned={badge.earned}
          earnedDate={badge.earnedDate}
          rarity={badge.rarity}
          size="md"
        />
      </div>
    ))}

    {hasMore && (
      <a
        href="/conquistas"
        class="w-20 h-20 rounded-xl border-2 border-dashed border-star-dust flex items-center justify-center text-dim hover:text-synapse-cyan hover:border-synapse-cyan/50 transition-colors"
      >
        <span class="text-sm font-medium">
          +{displayBadges.length - maxDisplay}
        </span>
      </a>
    )}
  </div>

  <!-- Stats Bar -->
  <div class="mt-4 p-4 rounded-lg bg-star-dust/30 flex items-center justify-between text-sm">
    <div class="flex items-center gap-6">
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-dim"></span>
        <span class="text-dim">Comum: {badges.filter(b => b.rarity === 'common' && b.earned).length}</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-synapse-cyan"></span>
        <span class="text-dim">Raro: {badges.filter(b => b.rarity === 'rare' && b.earned).length}</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-dendrite-violet"></span>
        <span class="text-dim">Epico: {badges.filter(b => b.rarity === 'epic' && b.earned).length}</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-axon-amber"></span>
        <span class="text-dim">Lendario: {badges.filter(b => b.rarity === 'legendary' && b.earned).length}</span>
      </div>
    </div>
  </div>
</section>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    opacity: 0;
    animation: fade-in 0.4s ease-out forwards;
  }
</style>
